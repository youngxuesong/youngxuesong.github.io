document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("ipInput");const n=document.getElementById("ipSearchBtn");const l=document.getElementById("ipAddress");const d=document.getElementById("ipLocation");const a=document.getElementById("ipAsn");const u=document.getElementById("ipAsnOwner");const p=document.getElementById("ipCompany");const f=document.getElementById("ipLongitude");const m=document.getElementById("ipLatitude");const o=document.getElementById("ipType");const t=document.getElementById("ipRisk");const s=document.getElementById("riskBarInner");const c=document.getElementById("riskValue");const g=document.getElementById("pingLink");const y=document.getElementById("traceLink");i();n.addEventListener("click",function(){let t=e.value.trim();if(t){r(t)}else{alert("请输入要查询的IP地址")}});e.addEventListener("keypress",function(t){if(t.key==="Enter"){n.click()}});function i(){fetch("https://api.ipify.org?format=json").then(t=>t.json()).then(t=>{e.value=t.ip;r(t.ip)}).catch(t=>{console.error("获取IP失败:",t)})}function r(e){B(true);fetch(`https://ipinfo.io/${e}/json`).then(t=>t.json()).then(t=>{C(e,t)}).catch(t=>{console.error("查询IP失败:",t);E();alert("查询失败，请检查IP格式或稍后重试")}).finally(()=>{B(false)})}function C(t,e){l.textContent=t;if(e.country&&e.region&&e.city){let t="";if(e.country==="CN"){t="🇨🇳 "}else if(e.country==="HK"){t="🇭🇰 "}else if(e.country==="US"){t="🇺🇸 "}d.textContent=`${t}${e.country} ${e.region} ${e.city}`}else{d.textContent="未知"}if(e.org){const o=e.org.match(/AS(\d+)/);if(o){const s=o[1];a.innerHTML=`<a href="https://bgp.he.net/AS${s}" target="_blank">AS${s}</a>`}else{a.textContent="未知"}}else{a.textContent="未知"}if(e.org){const c=e.org.replace(/^AS\d+\s/,"");u.textContent=c;p.textContent=c}else{u.textContent="未知";p.textContent="未知"}if(e.loc){const[i,r]=e.loc.split(",");m.textContent=i;f.textContent=r}else{m.textContent="未知";f.textContent="未知"}I(t,e);const n=Math.floor(Math.random()*100);h(n);g.href=`https://ping.pe/${t}`;y.href=`https://ping.pe/${t}#traceroute`}function I(t,e){if(e.org&&e.org.toLowerCase().includes("cloud")){o.innerHTML='<span class="ip-type-label idc">IDC机房IP</span>'}else if(e.org&&(e.org.toLowerCase().includes("mobile")||e.org.toLowerCase().includes("carrier"))){o.innerHTML='<span class="ip-type-label mobile">移动网络IP</span>'}else{o.innerHTML='<span class="ip-type-label normal">普通IP</span>'}}function h(t){s.style.width=`${t}%`;c.textContent=`${t}% ${x(t)}`}function x(t){if(t<20){return"安全"}else if(t<40){return"低风险"}else if(t<60){return"中风险"}else if(t<80){return"高风险"}else{return"极高风险"}}function E(){l.textContent="-";d.textContent="-";a.textContent="-";u.textContent="-";p.textContent="-";f.textContent="-";m.textContent="-";o.textContent="-";s.style.width="0%";c.textContent="-"}function B(t){if(t){n.textContent="查询中...";n.disabled=true}else{n.textContent="查询";n.disabled=false}}const L=document.querySelectorAll("img.lazyload");const b=new IntersectionObserver(t=>{t.forEach(t=>{if(t.isIntersecting){const e=t.target;e.src=e.dataset.src;b.unobserve(e)}})});L.forEach(t=>b.observe(t))});